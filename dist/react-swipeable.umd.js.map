{"version":3,"file":"react-swipeable.umd.js","sources":["../src/index.ts"],"sourcesContent":["/* global document */\nimport * as React from \"react\";\n\nexport type HandledEvents = React.MouseEvent | TouchEvent | MouseEvent;\nexport type Vector2 = [number, number];\nexport type EventData = {\n  event: HandledEvents;\n  deltaX: number;\n  deltaY: number;\n  absX: number;\n  absY: number;\n  first: boolean;\n  initial: Vector2;\n  velocity: number;\n  dir: \"Left\" | \"Right\" | \"Up\" | \"Down\";\n};\n\nexport type SwipeCallback = (eventData: EventData) => void;\n\nexport interface SwipeableOptions {\n  // Event handler/callbacks\n  onSwiped?: SwipeCallback;\n  onSwipedLeft?: SwipeCallback;\n  onSwipedRight?: SwipeCallback;\n  onSwipedUp?: SwipeCallback;\n  onSwipedDown?: SwipeCallback;\n  onSwiping?: SwipeCallback;\n\n  // Configuration Props\n  delta?: number;\n  preventDefaultTouchmoveEvent?: boolean;\n  trackTouch?: boolean;\n  trackMouse?: boolean;\n  rotationAngle?: number;\n}\n\nexport interface SwipeableHandlers {\n  ref(element: HTMLElement | null): void;\n  onMouseDown?(event: React.MouseEvent): void;\n}\n\ntype StateEventData = {\n  event?: HandledEvents;\n  deltaX?: number;\n  deltaY?: number;\n  absX?: number;\n  absY?: number;\n  first: boolean;\n  initial: Vector2;\n  velocity?: number;\n  dir?: \"Left\" | \"Right\" | \"Up\" | \"Down\";\n};\n\ntype State = {\n  xy: Vector2;\n  swiping: boolean;\n  eventData?: StateEventData;\n  start: number;\n  first?: boolean;\n  cleanUpTouch?(): void;\n  el?: HTMLElement;\n};\n\ntype Props = {\n  // Event handler/callbacks\n  onSwiped?: SwipeCallback;\n  onSwipedLeft?: SwipeCallback;\n  onSwipedRight?: SwipeCallback;\n  onSwipedUp?: SwipeCallback;\n  onSwipedDown?: SwipeCallback;\n  onSwiping?: SwipeCallback;\n\n  // Configuration Props\n  delta: number;\n  preventDefaultTouchmoveEvent: boolean;\n  trackTouch: boolean;\n  trackMouse: boolean;\n  rotationAngle: number;\n};\n\nconst defaultProps = {\n  preventDefaultTouchmoveEvent: false,\n  delta: 10,\n  rotationAngle: 0,\n  trackMouse: false,\n  trackTouch: true,\n};\n\nconst initialState: State = {\n  xy: [0, 0],\n  swiping: false,\n  eventData: undefined,\n  start: 0,\n};\nexport const LEFT = \"Left\";\nexport const RIGHT = \"Right\";\nexport const UP = \"Up\";\nexport const DOWN = \"Down\";\nconst touchStart = \"touchstart\";\nconst touchMove = \"touchmove\";\nconst touchEnd = \"touchend\";\nconst mouseMove = \"mousemove\";\nconst mouseUp = \"mouseup\";\n\nfunction getDirection(\n  absX: number,\n  absY: number,\n  deltaX: number,\n  deltaY: number\n) {\n  if (absX > absY) {\n    if (deltaX > 0) {\n      return LEFT;\n    }\n    return RIGHT;\n  } else if (deltaY > 0) {\n    return UP;\n  }\n  return DOWN;\n}\n\nfunction rotateXYByAngle(pos: Vector2, angle: number): Vector2 {\n  if (angle === 0) return pos;\n  const angleInRadians = (Math.PI / 180) * angle;\n  const x =\n    pos[0] * Math.cos(angleInRadians) + pos[1] * Math.sin(angleInRadians);\n  const y =\n    pos[1] * Math.cos(angleInRadians) - pos[0] * Math.sin(angleInRadians);\n  return [x, y];\n}\n\ntype Setter = (state: State, props: Props) => State;\ntype Set = (setter: Setter) => void;\nfunction getHandlers(\n  set: Set,\n  handlerProps: { trackMouse: boolean | undefined }\n): [\n  {\n    ref: (element: HTMLElement | null) => void;\n    onMouseDown?: (event: React.MouseEvent) => void;\n  },\n  (el: any) => (() => void) | undefined\n] {\n  const onStart = (event: HandledEvents) => {\n    // if more than a single touch don't track, for now...\n    if (event && \"touches\" in event && event.touches.length > 1) return;\n    console.log(\"urmit\", event);\n    set((state, props) => {\n      // setup mouse listeners on document to track swipe since swipe can leave container\n      if (props.trackMouse) {\n        document.addEventListener(mouseMove, onMove);\n        document.addEventListener(mouseUp, onUp);\n      }\n      const { clientX, clientY } =\n        \"touches\" in event ? event.touches[0] : event;\n      const xy = rotateXYByAngle([clientX, clientY], props.rotationAngle);\n      return {\n        ...state,\n        ...initialState,\n        eventData: { initial: [...xy], first: true },\n        xy,\n        start: event.timeStamp || 0,\n      };\n    });\n  };\n\n  const onMove = (event: HandledEvents) => {\n    set((state, props) => {\n      if (\n        state.xy[0] === undefined ||\n        state.xy[1] === undefined ||\n        (\"touches\" in event && event.touches.length > 1)\n      ) {\n        return state;\n      }\n      const { clientX, clientY } =\n        \"touches\" in event ? event.touches[0] : event;\n      const [x, y] = rotateXYByAngle([clientX, clientY], props.rotationAngle);\n      const deltaX = state.xy[0] - x;\n      const deltaY = state.xy[1] - y;\n      const absX = Math.abs(deltaX);\n      const absY = Math.abs(deltaY);\n      const time = (event.timeStamp || 0) - state.start;\n      const velocity = Math.sqrt(absX * absX + absY * absY) / (time || 1);\n\n      // if swipe is under delta and we have not started to track a swipe: skip update\n      if (absX < props.delta && absY < props.delta && !state.swiping)\n        return state;\n\n      const dir = getDirection(absX, absY, deltaX, deltaY);\n      const eventData: EventData = {\n        ...state.eventData,\n        event,\n        absX,\n        absY,\n        deltaX,\n        deltaY,\n        velocity,\n        dir,\n      } as EventData;\n\n      props.onSwiping && props.onSwiping(eventData);\n\n      // track if a swipe is cancelable(handler for swiping or swiped(dir) exists)\n      // so we can call preventDefault if needed\n      let cancelablePageSwipe = false;\n      if (props.onSwiping || props.onSwiped || `onSwiped${dir}` in props) {\n        cancelablePageSwipe = true;\n      }\n\n      if (\n        cancelablePageSwipe &&\n        props.preventDefaultTouchmoveEvent &&\n        props.trackTouch &&\n        event.cancelable\n      )\n        event.preventDefault();\n\n      // first is now always false\n      return {\n        ...state,\n        eventData: { ...eventData, first: false },\n        swiping: true,\n      };\n    });\n  };\n\n  const onEnd = (event: HandledEvents) => {\n    set((state, props) => {\n      let eventData: EventData | undefined;\n      if (state.swiping) {\n        eventData = { ...state.eventData, event } as EventData;\n\n        props.onSwiped && props.onSwiped(eventData);\n\n        const onSwipedDir = `onSwiped${eventData.dir}`;\n        if (onSwipedDir in props) {\n          (props as any)[onSwipedDir](eventData);\n        }\n      }\n      return { ...state, ...initialState, eventData };\n    });\n  };\n\n  const cleanUpMouse = () => {\n    // safe to just call removeEventListener\n    document.removeEventListener(mouseMove, onMove);\n    document.removeEventListener(mouseUp, onUp);\n  };\n\n  const onUp = (e: HandledEvents) => {\n    cleanUpMouse();\n    onEnd(e);\n  };\n\n  const attachTouch = (el: HTMLElement) => {\n    if (el && el.addEventListener) {\n      // attach touch event listeners and handlers\n      const tls: [\n        typeof touchStart | typeof touchMove | typeof touchEnd,\n        (e: HandledEvents) => void\n      ][] = [\n        [touchStart, onStart],\n        [touchMove, onMove],\n        [touchEnd, onEnd],\n      ];\n      tls.forEach(([e, h]) => el.addEventListener(e, h));\n      // return properly scoped cleanup method for removing listeners\n      return () => tls.forEach(([e, h]) => el.removeEventListener(e, h));\n    }\n  };\n\n  const onRef = (el: HTMLElement | null) => {\n    // \"inline\" ref functions are called twice on render, once with null then again with DOM element\n    // ignore null here\n    if (el === null) return;\n    set((state, props) => {\n      // if the same DOM el as previous just return state\n      if (state.el === el) return state;\n\n      const addState: { cleanUpTouch?: (() => void) | null } = {};\n      // if new DOM el clean up old DOM and reset cleanUpTouch\n      if (state.el && state.el !== el && state.cleanUpTouch) {\n        state.cleanUpTouch();\n        addState.cleanUpTouch = null;\n      }\n      // only attach if we want to track touch\n      if (props.trackTouch && el) {\n        addState.cleanUpTouch = attachTouch(el);\n      }\n\n      // store event attached DOM el for comparison, clean up, and re-attachment\n      return { ...state, el, ...addState } as State;\n    });\n  };\n\n  // set ref callback to attach touch event listeners\n  const output: { ref: typeof onRef; onMouseDown?: typeof onStart } = {\n    ref: onRef,\n  };\n\n  // if track mouse attach mouse down listener\n  if (handlerProps.trackMouse) {\n    output.onMouseDown = onStart;\n  }\n\n  return [output, attachTouch];\n}\n\nfunction updateTransientState(\n  state: State,\n  props: Props,\n  attachTouch: (el: any) => (() => void) | undefined\n) {\n  const addState: { cleanUpTouch?(): void } = {};\n  // clean up touch handlers if no longer tracking touches\n  if (!props.trackTouch && state.cleanUpTouch) {\n    state.cleanUpTouch();\n    addState.cleanUpTouch = undefined;\n  } else if (props.trackTouch && !state.cleanUpTouch) {\n    // attach/re-attach touch handlers\n    if (state.el) {\n      addState.cleanUpTouch = attachTouch(state.el);\n    }\n  }\n  return { ...state, ...addState };\n}\n\nexport function useSwipeable(options: SwipeableOptions): SwipeableHandlers {\n  const { trackMouse } = options;\n  const transientState = React.useRef({ ...initialState });\n  const transientProps = React.useRef<Props>({ ...defaultProps });\n  transientProps.current = { ...defaultProps, ...options };\n\n  const [handlers, attachTouch] = React.useMemo(\n    () =>\n      getHandlers(\n        (cb) =>\n          (transientState.current = cb(\n            transientState.current,\n            transientProps.current\n          )),\n        { trackMouse }\n      ),\n    [trackMouse]\n  );\n\n  transientState.current = updateTransientState(\n    transientState.current,\n    transientProps.current,\n    attachTouch\n  );\n\n  return handlers;\n}\n"],"names":["defaultProps","preventDefaultTouchmoveEvent","delta","rotationAngle","trackMouse","trackTouch","initialState","xy","swiping","eventData","undefined","start","LEFT","RIGHT","UP","DOWN","touchStart","touchMove","touchEnd","mouseMove","mouseUp","getDirection","absX","absY","deltaX","deltaY","rotateXYByAngle","pos","angle","angleInRadians","Math","PI","x","cos","sin","y","getHandlers","set","handlerProps","onStart","event","touches","length","console","log","state","props","document","addEventListener","onMove","onUp","clientX","clientY","initial","first","timeStamp","abs","time","velocity","sqrt","dir","onSwiping","cancelablePageSwipe","onSwiped","cancelable","preventDefault","onEnd","onSwipedDir","cleanUpMouse","removeEventListener","e","attachTouch","el","tls","forEach","h","onRef","addState","cleanUpTouch","output","ref","onMouseDown","updateTransientState","useSwipeable","options","transientState","React","transientProps","current","cb","handlers"],"mappings":"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"}